<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mon Compte | ReCore</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="navbar">
    <div class="logo">ReCore</div>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="produits.html">Produits</a>
        <a href="compte.html">Mon compte</a>
    </nav>
</header>

<section class="page-hero">
    <h1>Mon Compte</h1>
    <p id="status">Chargement...</p>
</section>

<section class="section">
    <div class="account-card" id="account-info" style="display:none;">

        <div class="account-row">
            <span class="label">Nom</span>
            <input type="text" id="nom" disabled>
        </div>

        <div class="account-row">
            <span class="label">Pr√©nom</span>
            <input type="text" id="prenom" disabled>
        </div>

        <div class="account-row">
            <span class="label">Adresse</span>
            <input type="text" id="adresse" disabled>
        </div>

        <div class="account-row">
            <span class="label">Email</span>
            <div class="email-container">
                <input type="email" id="email" disabled>
                <span id="email-badge" class="badge"></span>
            </div>
        </div>

        <div class="account-actions">
            <button class="btn" onclick="enableEdit()">Modifier</button>
            <button class="btn" id="saveBtn" style="display:none;" onclick="saveProfile()">Sauvegarder</button>
            <button class="btn" onclick="logout()">D√©connexion</button>
        </div>

    </div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBvmqa7MUYKePUHSYq69XmhN9N7GdNvlPU",
  authDomain: "recore-f320c.firebaseapp.com",
  projectId: "recore-f320c",
  storageBucket: "recore-f320c.firebasestorage.app",
  messagingSenderId: "560442114914",
  appId: "1:560442114914:web:9c2bf7f43f3336954ca23b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

onAuthStateChanged(auth, async (user) => {

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    currentUser = user;

    document.getElementById("status").innerText = "Bienvenue üëã";
    document.getElementById("account-info").style.display = "block";

    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("nom").value = data.nom;
        document.getElementById("prenom").value = data.prenom;
        document.getElementById("adresse").value = data.adresse;
        document.getElementById("email").value = data.email;
    }

    const badge = document.getElementById("email-badge");

    if (user.emailVerified) {
        badge.innerText = "V√©rifi√©";
        badge.classList.add("verified");
    } else {
        badge.innerText = "Non v√©rifi√©";
        badge.classList.add("not-verified");
    }

});

window.enableEdit = function() {

    document.getElementById("nom").disabled = false;
    document.getElementById("prenom").disabled = false;
    document.getElementById("adresse").disabled = false;

    document.getElementById("saveBtn").style.display = "inline-block";
}

window.saveProfile = async function() {

    await updateDoc(doc(db, "users", currentUser.uid), {
        nom: document.getElementById("nom").value,
        prenom: document.getElementById("prenom").value,
        adresse: document.getElementById("adresse").value
    });

    document.getElementById("nom").disabled = true;
    document.getElementById("prenom").disabled = true;
    document.getElementById("adresse").disabled = true;

    document.getElementById("saveBtn").style.display = "none";

    alert("Profil mis √† jour !");
}

window.logout = function() {
    signOut(auth);
    window.location.href = "login.html";
}
</script>

</body>
</html>
